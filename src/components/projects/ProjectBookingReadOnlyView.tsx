import { useState, useEffect } from "react";
import { X } from "lucide-react";
import { BookingCommentsTab } from "../shared/BookingCommentsTab";
import { BillingsTab } from "../operations/shared/BillingsTab";
import { ExpensesTab } from "../operations/shared/ExpensesTab";
import { projectId, publicAnonKey } from "../../utils/supabase/info";

const API_URL = `https://${projectId}.supabase.co/functions/v1/make-server-c142e950`;

interface ProjectBookingReadOnlyViewProps {
  bookingId: string;
  bookingType: "forwarding" | "brokerage" | "trucking" | "marine-insurance" | "others";
  onBack: () => void;
  currentUser?: {
    id: string;
    name: string;
    email: string;
    department: string;
  } | null;
}

type DetailTab = "booking-info" | "billings" | "expenses" | "comments";

export function ProjectBookingReadOnlyView({
  bookingId,
  bookingType,
  onBack,
  currentUser
}: ProjectBookingReadOnlyViewProps) {
  const [activeTab, setActiveTab] = useState<DetailTab>("booking-info");
  const [booking, setBooking] = useState<any>(null);
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    fetchBooking();
  }, [bookingId, bookingType]);

  // Handle ESC key to close drawer
  useEffect(() => {
    const handleKeyDown = (e: KeyboardEvent) => {
      if (e.key === "Escape") {
        onBack();
      }
    };

    window.addEventListener("keydown", handleKeyDown);
    return () => window.removeEventListener("keydown", handleKeyDown);
  }, [onBack]);

  const fetchBooking = async () => {
    try {
      setIsLoading(true);
      
      console.log("[ProjectBookingReadOnlyView] Fetching booking:", { bookingId, bookingType });
      
      // Validate bookingType before proceeding
      if (!bookingType) {
        console.error("[ProjectBookingReadOnlyView] Error: bookingType is undefined");
        throw new Error("Booking type is required but was not provided");
      }
      
      // Normalize booking type to lowercase for mapping
      const normalizedType = bookingType.toLowerCase();
      
      // Map bookingType to the correct endpoint format
      const endpointMap: Record<string, string> = {
        "forwarding": "forwarding-bookings",
        "brokerage": "brokerage-bookings",
        "trucking": "trucking-bookings",
        "marine-insurance": "marine-insurance-bookings",
        "marine insurance": "marine-insurance-bookings",
        "others": "others-bookings"
      };
      
      const endpoint = endpointMap[normalizedType];
      if (!endpoint) {
        console.error("[ProjectBookingReadOnlyView] Invalid booking type:", bookingType, "normalized:", normalizedType);
        throw new Error(`Invalid booking type: ${bookingType}`);
      }

      console.log("[ProjectBookingReadOnlyView] Using endpoint:", endpoint);

      const response = await fetch(
        `${API_URL}/${endpoint}/${bookingId}`,
        {
          headers: {
            Authorization: `Bearer ${publicAnonKey}`,
          },
        }
      );

      if (!response.ok) {
        throw new Error("Failed to fetch booking");
      }

      const data = await response.json();
      console.log("[ProjectBookingReadOnlyView] Booking data fetched:", data);
      setBooking(data);
    } catch (error) {
      console.error("[ProjectBookingReadOnlyView] Error fetching booking:", error);
    } finally {
      setIsLoading(false);
    }
  };

  const getBookingTypeName = () => {
    const typeMap: Record<string, string> = {
      "forwarding": "Forwarding",
      "brokerage": "Brokerage",
      "trucking": "Trucking",
      "marine-insurance": "Marine Insurance",
      "others": "Others"
    };
    return typeMap[bookingType] || bookingType;
  };

  return (
    <>
      {/* Backdrop */}
      <div
        onClick={onBack}
        style={{
          position: "fixed",
          top: 0,
          left: 0,
          right: 0,
          bottom: 0,
          backgroundColor: "rgba(18, 51, 43, 0.4)",
          zIndex: 999,
          animation: "fadeIn 0.2s ease-out",
          cursor: "pointer"
        }}
      />

      {/* Drawer Panel */}
      <div
        onClick={(e) => e.stopPropagation()}
        style={{
          position: "fixed",
          top: 0,
          right: 0,
          bottom: 0,
          width: "70%",
          backgroundColor: "white",
          zIndex: 1000,
          display: "flex",
          flexDirection: "column",
          boxShadow: "-4px 0 24px rgba(0, 0, 0, 0.12)",
          animation: "slideInRight 0.3s ease-out"
        }}
      >
        {isLoading ? (
          <div style={{
            display: "flex",
            alignItems: "center",
            justifyContent: "center",
            height: "100%"
          }}>
            <p style={{ color: "var(--neuron-ink-muted)" }}>Loading booking details...</p>
          </div>
        ) : !booking ? (
          <div style={{
            display: "flex",
            flexDirection: "column",
            alignItems: "center",
            justifyContent: "center",
            height: "100%"
          }}>
            <p style={{ color: "var(--neuron-ink-muted)", marginBottom: "16px" }}>Booking not found</p>
            <button
              onClick={onBack}
              style={{
                padding: "10px 20px",
                backgroundColor: "var(--neuron-brand-green)",
                color: "white",
                border: "none",
                borderRadius: "6px",
                cursor: "pointer"
              }}
            >
              Close
            </button>
          </div>
        ) : (
          <>
            {/* Header */}
            <div style={{
              padding: "20px 32px",
              borderBottom: "1px solid var(--neuron-ui-border)",
              backgroundColor: "#F8FBFB",
              display: "flex",
              justifyContent: "space-between",
              alignItems: "flex-start",
              flexShrink: 0
            }}>
              <div style={{ flex: 1 }}>
                <h1 style={{
                  fontSize: "18px",
                  fontWeight: 600,
                  color: "var(--neuron-ink-primary)",
                  marginBottom: "4px"
                }}>
                  {bookingId}
                </h1>
                <p style={{ fontSize: "13px", color: "var(--neuron-ink-muted)", margin: 0 }}>
                  {booking.customerName && booking.customerName !== "—" 
                    ? `${booking.customerName} • ${getBookingTypeName()} Booking`
                    : `${getBookingTypeName()} Booking`
                  }
                </p>
              </div>

              {/* Close Button */}
              <button
                onClick={onBack}
                style={{
                  background: "none",
                  border: "none",
                  padding: "8px",
                  cursor: "pointer",
                  color: "var(--neuron-ink-secondary)",
                  borderRadius: "6px",
                  display: "flex",
                  alignItems: "center",
                  justifyContent: "center",
                  transition: "all 0.2s ease"
                }}
                onMouseEnter={(e) => {
                  e.currentTarget.style.backgroundColor = "#F3F4F6";
                  e.currentTarget.style.color = "var(--neuron-ink-primary)";
                }}
                onMouseLeave={(e) => {
                  e.currentTarget.style.backgroundColor = "transparent";
                  e.currentTarget.style.color = "var(--neuron-ink-secondary)";
                }}
              >
                <X size={20} />
              </button>
            </div>

            {/* Tabs */}
            <div style={{
              padding: "0 32px",
              borderBottom: "1px solid var(--neuron-ui-border)",
              backgroundColor: "white",
              display: "flex",
              gap: "24px",
              flexShrink: 0
            }}>
              <button
                onClick={() => setActiveTab("booking-info")}
                style={{
                  padding: "14px 0",
                  background: "none",
                  border: "none",
                  borderBottom: activeTab === "booking-info" ? "2px solid #0F766E" : "2px solid transparent",
                  color: activeTab === "booking-info" ? "#0F766E" : "#667085",
                  fontSize: "13px",
                  fontWeight: 600,
                  cursor: "pointer",
                  transition: "all 0.2s ease",
                  marginBottom: "-1px"
                }}
              >
                Booking Info
              </button>
              <button
                onClick={() => setActiveTab("billings")}
                style={{
                  padding: "14px 0",
                  background: "none",
                  border: "none",
                  borderBottom: activeTab === "billings" ? "2px solid #0F766E" : "2px solid transparent",
                  color: activeTab === "billings" ? "#0F766E" : "#667085",
                  fontSize: "13px",
                  fontWeight: 600,
                  cursor: "pointer",
                  transition: "all 0.2s ease",
                  marginBottom: "-1px"
                }}
              >
                Billings
              </button>
              <button
                onClick={() => setActiveTab("expenses")}
                style={{
                  padding: "14px 0",
                  background: "none",
                  border: "none",
                  borderBottom: activeTab === "expenses" ? "2px solid #0F766E" : "2px solid transparent",
                  color: activeTab === "expenses" ? "#0F766E" : "#667085",
                  fontSize: "13px",
                  fontWeight: 600,
                  cursor: "pointer",
                  transition: "all 0.2s ease",
                  marginBottom: "-1px"
                }}
              >
                Expenses
              </button>
              <button
                onClick={() => setActiveTab("comments")}
                style={{
                  padding: "14px 0",
                  background: "none",
                  border: "none",
                  borderBottom: activeTab === "comments" ? "2px solid #0F766E" : "2px solid transparent",
                  color: activeTab === "comments" ? "#0F766E" : "#667085",
                  fontSize: "13px",
                  fontWeight: 600,
                  cursor: "pointer",
                  transition: "all 0.2s ease",
                  marginBottom: "-1px"
                }}
              >
                Comments
              </button>
            </div>

            {/* Content */}
            <div style={{
              flex: 1,
              overflow: "auto",
              backgroundColor: "#FAFAFA"
            }}>
              {activeTab === "booking-info" && (
                <BookingInformationReadOnly booking={booking} bookingType={bookingType} />
              )}
              {activeTab === "billings" && (
                <BillingsTab
                  bookingId={bookingId}
                  currentUserId={currentUser?.email || "unknown"}
                  currentUserName={currentUser?.name || "Unknown User"}
                  currentUserDepartment={currentUser?.department || "BD"}
                  readOnly={true}
                />
              )}
              {activeTab === "expenses" && (
                <ExpensesTab
                  bookingId={bookingId}
                  currentUserId={currentUser?.email || "unknown"}
                  currentUserName={currentUser?.name || "Unknown User"}
                  currentUserDepartment={currentUser?.department || "BD"}
                  readOnly={true}
                />
              )}
              {activeTab === "comments" && (
                <BookingCommentsTab
                  bookingId={bookingId}
                  currentUserId={currentUser?.email || "unknown"}
                  currentUserName={currentUser?.name || "Unknown User"}
                  currentUserDepartment={currentUser?.department || "BD"}
                />
              )}
            </div>
          </>
        )}
      </div>

      <style>{`
        @keyframes fadeIn {
          from { opacity: 0; }
          to { opacity: 1; }
        }
        
        @keyframes slideInRight {
          from {
            transform: translateX(100%);
          }
          to {
            transform: translateX(0);
          }
        }
      `}</style>
    </>
  );
}

// Read-only booking information display
function BookingInformationReadOnly({ booking, bookingType }: { booking: any; bookingType: string }) {
  return (
    <div style={{
      padding: "24px 32px"
    }}>
      {/* General Information Section */}
      <div style={{
        backgroundColor: "white",
        border: "1px solid var(--neuron-ui-border)",
        borderRadius: "8px",
        padding: "24px",
        marginBottom: "20px"
      }}>
        <h2 style={{
          fontSize: "15px",
          fontWeight: 600,
          color: "var(--neuron-brand-green)",
          marginBottom: "20px"
        }}>
          General Information
        </h2>

        <div style={{ display: "grid", gap: "20px" }}>
          {/* Row 1: Customer Name, Account Owner */}
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: "20px" }}>
            <ReadOnlyField label="Customer Name" value={booking.customerName} />
            <ReadOnlyField label="Account Owner" value={booking.accountOwner} />
          </div>

          {/* Row 2: Account Handler, Mode, Type of Entry (for Forwarding) or just Account Handler + Service for others */}
          {bookingType === "forwarding" ? (
            <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: "20px" }}>
              <ReadOnlyField label="Account Handler" value={booking.accountHandler} />
              <ReadOnlyField label="Mode" value={booking.mode} />
              <ReadOnlyField label="Type of Entry" value={booking.typeOfEntry} />
            </div>
          ) : bookingType === "brokerage" ? (
            <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: "20px" }}>
              <ReadOnlyField label="Account Handler" value={booking.accountHandler} />
              <ReadOnlyField label="Mode" value={booking.mode} />
              <ReadOnlyField label="Service/s" value={booking.service} />
            </div>
          ) : bookingType === "trucking" ? (
            <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: "20px" }}>
              <ReadOnlyField label="Account Handler" value={booking.accountHandler} />
              <ReadOnlyField label="Service/s" value={booking.service} />
              <ReadOnlyField label="Truck Type" value={booking.truckType} />
            </div>
          ) : (
            <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: "20px" }}>
              <ReadOnlyField label="Account Handler" value={booking.accountHandler} />
              <ReadOnlyField label="Service/s" value={booking.service || booking.services?.join(", ")} />
            </div>
          )}

          {/* Row 3: Brokerage specific fields */}
          {bookingType === "brokerage" ? (
            <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: "20px" }}>
              <ReadOnlyField label="Incoterms" value={booking.incoterms} />
              <ReadOnlyField label="Cargo Type" value={booking.cargoType} />
              <ReadOnlyField label="Quotation Reference" value={booking.quotationReferenceNumber} />
            </div>
          ) : bookingType === "trucking" ? (
            <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: "20px" }}>
              <ReadOnlyField label="Mode" value={booking.mode} />
              <ReadOnlyField 
                label="Preferred Delivery Date" 
                value={booking.preferredDeliveryDate ? new Date(booking.preferredDeliveryDate).toLocaleDateString() : "—"} 
              />
              <ReadOnlyField label="Quotation Reference" value={booking.quotationReferenceNumber} />
            </div>
          ) : bookingType === "forwarding" ? (
            <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: "20px" }}>
              <ReadOnlyField label="Cargo Type" value={booking.cargoType} />
              <ReadOnlyField label="Quotation Reference" value={booking.quotationReferenceNumber} />
              {booking.projectNumber && (
                <ReadOnlyField label="Project Number" value={booking.projectNumber} />
              )}
            </div>
          ) : (
            <>
              <ReadOnlyField label="Quotation Reference" value={booking.quotationReferenceNumber} />
              {booking.projectNumber && (
                <ReadOnlyField label="Project Number" value={booking.projectNumber} />
              )}
            </>
          )}

          {/* Row 4: Cargo Nature (Brokerage only, conditional) */}
          {bookingType === "brokerage" && booking.cargoNature && (
            <ReadOnlyField label="Cargo Nature" value={booking.cargoNature} />
          )}

          {/* Row 5: Delivery Address (for Forwarding) */}
          {bookingType === "forwarding" && (
            <ReadOnlyField 
              label="Delivery Address" 
              value={booking.deliveryAddress} 
              multiline 
            />
          )}
        </div>
      </div>

      {/* Service-Specific Details */}
      {bookingType === "forwarding" && <ForwardingDetails booking={booking} />}
      {bookingType === "brokerage" && <BrokerageDetails booking={booking} />}
      {bookingType === "trucking" && <TruckingDetails booking={booking} />}
      {bookingType === "marine-insurance" && <MarineInsuranceDetails booking={booking} />}
      {bookingType === "others" && <OthersDetails booking={booking} />}

      {/* Additional Notes */}
      {booking.notes && (
        <div style={{
          backgroundColor: "white",
          border: "1px solid var(--neuron-ui-border)",
          borderRadius: "8px",
          padding: "24px",
          marginTop: "20px"
        }}>
          <h2 style={{
            fontSize: "15px",
            fontWeight: 600,
            color: "var(--neuron-brand-green)",
            marginBottom: "16px"
          }}>
            Additional Notes
          </h2>
          <ReadOnlyField label="Notes" value={booking.notes} multiline />
        </div>
      )}
    </div>
  );
}

// Read-only field component
function ReadOnlyField({ label, value, multiline = false }: { label: string; value: any; multiline?: boolean }) {
  const displayValue = value || "—";

  return (
    <div>
      <label style={{
        display: "block",
        fontSize: "12px",
        fontWeight: 500,
        color: "var(--neuron-ink-base)",
        marginBottom: "6px"
      }}>
        {label}
      </label>
      <div style={{
        padding: "9px 12px",
        backgroundColor: "#F9FAFB",
        border: "1px solid #E5E7EB",
        borderRadius: "6px",
        fontSize: "13px",
        color: "#374151",
        minHeight: multiline ? "70px" : "38px",
        whiteSpace: multiline ? "pre-wrap" : "normal"
      }}>
        {displayValue}
      </div>
    </div>
  );
}

// Service-specific detail components
function ForwardingDetails({ booking }: { booking: any }) {
  return (
    <>
      <div style={{
        backgroundColor: "white",
        border: "1px solid var(--neuron-ui-border)",
        borderRadius: "8px",
        padding: "24px",
        marginBottom: "20px"
      }}>
        <h2 style={{
          fontSize: "15px",
          fontWeight: 600,
          color: "var(--neuron-brand-green)",
          marginBottom: "20px"
        }}>
          Shipment Information
        </h2>

        <div style={{ display: "grid", gap: "20px" }}>
          {/* Row 1: Consignee, Shipper */}
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: "20px" }}>
            <ReadOnlyField label="Consignee" value={booking.consignee} />
            <ReadOnlyField label="Shipper" value={booking.shipper} />
          </div>

          {/* Row 2: MBL/MAWB, HBL/HAWB, Registry Number */}
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: "20px" }}>
            <ReadOnlyField label="MBL/MAWB" value={booking.mblMawb} />
            <ReadOnlyField label="HBL/HAWB" value={booking.hblHawb} />
            <ReadOnlyField label="Registry Number" value={booking.registryNumber} />
          </div>

          {/* Row 3: Carrier, Forwarder */}
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: "20px" }}>
            <ReadOnlyField label="Carrier" value={booking.carrier} />
            <ReadOnlyField label="Forwarder" value={booking.forwarder} />
          </div>

          {/* Row 4: POD */}
          {booking.pod && (
            <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: "20px" }}>
              <ReadOnlyField label="POD (Port of Discharge)" value={booking.pod} />
              <div /> {/* Empty cell for layout */}
            </div>
          )}

          {/* Commodity Description */}
          <ReadOnlyField 
            label="Commodity Description" 
            value={booking.commodityDescription} 
            multiline 
          />

          {/* Row 5: Gross Weight, Dimensions */}
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: "20px" }}>
            <ReadOnlyField label="Gross Weight" value={booking.grossWeight} />
            <ReadOnlyField label="Dimensions" value={booking.dimensions} />
          </div>
        </div>
      </div>

      {/* Container Details (FCL only) */}
      {booking.mode === "FCL" && booking.containerNumbers && booking.containerNumbers.length > 0 && (
        <div style={{
          backgroundColor: "white",
          border: "1px solid var(--neuron-ui-border)",
          borderRadius: "8px",
          padding: "24px",
          marginBottom: "20px"
        }}>
          <h2 style={{
            fontSize: "15px",
            fontWeight: 600,
            color: "var(--neuron-brand-green)",
            marginBottom: "20px"
          }}>
            Container Details
          </h2>

          <ReadOnlyField 
            label="Container Numbers" 
            value={booking.containerNumbers.join(", ")} 
            multiline 
          />
        </div>
      )}
    </>
  );
}

function BrokerageDetails({ booking }: { booking: any }) {
  return (
    <>
      {/* Shipment Information Section */}
      <div style={{
        backgroundColor: "white",
        border: "1px solid var(--neuron-ui-border)",
        borderRadius: "8px",
        padding: "24px",
        marginBottom: "20px"
      }}>
        <h2 style={{
          fontSize: "15px",
          fontWeight: 600,
          color: "var(--neuron-brand-green)",
          marginBottom: "20px"
        }}>
          Shipment Information
        </h2>

        <div style={{ display: "grid", gap: "20px" }}>
          {/* Row 1: Consignee, Shipper */}
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: "20px" }}>
            <ReadOnlyField label="Consignee" value={booking.consignee} />
            <ReadOnlyField label="Shipper" value={booking.shipper} />
          </div>

          {/* Row 2: MBL/MAWB, HBL/HAWB, Registry Number */}
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: "20px" }}>
            <ReadOnlyField label="MBL/MAWB" value={booking.mblMawb} />
            <ReadOnlyField label="HBL/HAWB" value={booking.hblHawb} />
            <ReadOnlyField label="Registry Number" value={booking.registryNumber} />
          </div>

          {/* Row 3: Carrier, Forwarder */}
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: "20px" }}>
            <ReadOnlyField label="Carrier" value={booking.carrier} />
            <ReadOnlyField label="Forwarder" value={booking.forwarder} />
          </div>

          {/* Row 4: POD */}
          {booking.pod && (
            <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: "20px" }}>
              <ReadOnlyField label="POD (Port of Discharge)" value={booking.pod} />
              <div /> {/* Empty cell for layout */}
            </div>
          )}

          {/* Commodity Description */}
          <ReadOnlyField 
            label="Commodity Description" 
            value={booking.commodityDescription} 
            multiline 
          />

          {/* Row 5: Gross Weight, Dimensions */}
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: "20px" }}>
            <ReadOnlyField label="Gross Weight" value={booking.grossWeight} />
            <ReadOnlyField label="Dimensions" value={booking.dimensions} />
          </div>
        </div>
      </div>
    </>
  );
}

function TruckingDetails({ booking }: { booking: any }) {
  return (
    <>
      {/* Shipment Information Section */}
      <div style={{
        backgroundColor: "white",
        border: "1px solid var(--neuron-ui-border)",
        borderRadius: "8px",
        padding: "24px",
        marginBottom: "20px"
      }}>
        <h2 style={{
          fontSize: "15px",
          fontWeight: 600,
          color: "var(--neuron-brand-green)",
          marginBottom: "20px"
        }}>
          Shipment Information
        </h2>

        <div style={{ display: "grid", gap: "20px" }}>
          {/* Row 1: Consignee, Driver */}
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: "20px" }}>
            <ReadOnlyField label="Consignee" value={booking.consignee} />
            <ReadOnlyField label="Driver" value={booking.driver} />
          </div>

          {/* Row 2: Helper, Vehicle Reference Number, Pull Out */}
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: "20px" }}>
            <ReadOnlyField label="Helper" value={booking.helper} />
            <ReadOnlyField label="Vehicle Reference Number" value={booking.vehicleReferenceNumber} />
            <ReadOnlyField label="Pull Out Location" value={booking.pullOut} />
          </div>

          {/* Row 3: Delivery Address */}
          <ReadOnlyField 
            label="Delivery Address" 
            value={booking.deliveryAddress} 
            multiline 
          />

          {/* Row 4: Delivery Instructions */}
          <ReadOnlyField 
            label="Delivery Instructions" 
            value={booking.deliveryInstructions} 
            multiline 
          />

          {/* Row 5: Date Delivered (conditional) */}
          {booking.dateDelivered && (
            <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: "20px" }}>
              <ReadOnlyField 
                label="Date Delivered" 
                value={booking.dateDelivered ? new Date(booking.dateDelivered).toLocaleDateString() : "—"} 
              />
              <div /> {/* Empty cell */}
            </div>
          )}
        </div>
      </div>

      {/* FCL Information Section (conditional) */}
      {(booking.tabsBooking || booking.emptyReturn || booking.cyFee || booking.eirAvailability || 
        booking.earlyGateIn || booking.detDemValidity || booking.storageValidity || booking.shippingLine) && (
        <div style={{
          backgroundColor: "white",
          border: "1px solid var(--neuron-ui-border)",
          borderRadius: "8px",
          padding: "24px",
          marginBottom: "20px"
        }}>
          <h2 style={{
            fontSize: "15px",
            fontWeight: 600,
            color: "var(--neuron-brand-green)",
            marginBottom: "20px"
          }}>
            FCL Information
          </h2>

          <div style={{ display: "grid", gap: "20px" }}>
            <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: "20px" }}>
              {booking.tabsBooking && (
                <ReadOnlyField label="TABS Booking" value={booking.tabsBooking} />
              )}
              {booking.emptyReturn && (
                <ReadOnlyField label="Empty Return" value={booking.emptyReturn} />
              )}
              {booking.cyFee && (
                <ReadOnlyField label="CY Fee" value={booking.cyFee} />
              )}
            </div>

            <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: "20px" }}>
              {booking.eirAvailability && (
                <ReadOnlyField label="EIR Availability" value={booking.eirAvailability} />
              )}
              {booking.earlyGateIn && (
                <ReadOnlyField label="Early Gate In" value={booking.earlyGateIn} />
              )}
              {booking.detDemValidity && (
                <ReadOnlyField label="Det/Dem Validity" value={booking.detDemValidity} />
              )}
            </div>

            <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: "20px" }}>
              {booking.storageValidity && (
                <ReadOnlyField label="Storage Validity" value={booking.storageValidity} />
              )}
              {booking.shippingLine && (
                <ReadOnlyField label="Shipping Line" value={booking.shippingLine} />
              )}
            </div>
          </div>
        </div>
      )}
    </>
  );
}

function MarineInsuranceDetails({ booking }: { booking: any }) {
  return (
    <>
      {/* Policy Information Section */}
      <div style={{
        backgroundColor: "white",
        border: "1px solid var(--neuron-ui-border)",
        borderRadius: "8px",
        padding: "24px",
        marginBottom: "20px"
      }}>
        <h2 style={{
          fontSize: "15px",
          fontWeight: 600,
          color: "var(--neuron-brand-green)",
          marginBottom: "20px"
        }}>
          Policy Information
        </h2>

        <div style={{ display: "grid", gap: "20px" }}>
          {/* Row 1: Policy Number, Insurance Company, Coverage Type */}
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: "20px" }}>
            <ReadOnlyField label="Policy Number" value={booking.policyNumber} />
            <ReadOnlyField label="Insurance Company" value={booking.insuranceCompany} />
            <ReadOnlyField label="Coverage Type" value={booking.coverageType} />
          </div>

          {/* Row 2: Insured Value, Currency */}
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: "20px" }}>
            <ReadOnlyField label="Insured Value" value={booking.insuredValue} />
            <ReadOnlyField label="Currency" value={booking.currency} />
            <div /> {/* Empty cell */}
          </div>

          {/* Row 3: Effective Date, Expiry Date */}
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: "20px" }}>
            <ReadOnlyField 
              label="Effective Date" 
              value={booking.effectiveDate ? new Date(booking.effectiveDate).toLocaleDateString() : "—"} 
            />
            <ReadOnlyField 
              label="Expiry Date" 
              value={booking.expiryDate ? new Date(booking.expiryDate).toLocaleDateString() : "—"} 
            />
          </div>
        </div>
      </div>

      {/* Shipment Information Section */}
      <div style={{
        backgroundColor: "white",
        border: "1px solid var(--neuron-ui-border)",
        borderRadius: "8px",
        padding: "24px",
        marginBottom: "20px"
      }}>
        <h2 style={{
          fontSize: "15px",
          fontWeight: 600,
          color: "var(--neuron-brand-green)",
          marginBottom: "20px"
        }}>
          Shipment Information
        </h2>

        <div style={{ display: "grid", gap: "20px" }}>
          {/* Commodity Description */}
          <ReadOnlyField 
            label="Commodity Description" 
            value={booking.commodityDescription} 
            multiline 
          />

          {/* Row 1: HS Code, Invoice Number, Invoice Value */}
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: "20px" }}>
            <ReadOnlyField label="HS Code" value={booking.hsCode} />
            <ReadOnlyField label="Invoice Number" value={booking.invoiceNumber} />
            <ReadOnlyField label="Invoice Value" value={booking.invoiceValue} />
          </div>

          {/* Row 2: Packaging Type, Number of Packages, Weight */}
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: "20px" }}>
            <ReadOnlyField label="Packaging Type" value={booking.packagingType} />
            <ReadOnlyField label="Number of Packages" value={booking.numberOfPackages} />
            <ReadOnlyField label="Weight" value={booking.weight} />
          </div>

          {/* Row 3: Origin, Destination, Vessel/Voyage */}
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: "20px" }}>
            <ReadOnlyField label="Origin" value={booking.origin} />
            <ReadOnlyField label="Destination" value={booking.destination} />
            <ReadOnlyField label="Vessel/Voyage" value={booking.vesselVoyage} />
          </div>

          {/* Row 4: Mode of Transport, Departure Date, Arrival Date */}
          <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: "20px" }}>
            <ReadOnlyField label="Mode of Transport" value={booking.mode} />
            <ReadOnlyField 
              label="Departure Date" 
              value={booking.departureDate ? new Date(booking.departureDate).toLocaleDateString() : "—"} 
            />
            <ReadOnlyField 
              label="Arrival Date" 
              value={booking.arrivalDate ? new Date(booking.arrivalDate).toLocaleDateString() : "—"} 
            />
          </div>
        </div>
      </div>
    </>
  );
}

function OthersDetails({ booking }: { booking: any }) {
  return (
    <div style={{
      backgroundColor: "white",
      border: "1px solid var(--neuron-ui-border)",
      borderRadius: "8px",
      padding: "24px",
      marginBottom: "20px"
    }}>
      <h2 style={{
        fontSize: "15px",
        fontWeight: 600,
        color: "var(--neuron-brand-green)",
        marginBottom: "20px"
      }}>
        Service Details
      </h2>

      <div style={{ display: "grid", gap: "20px" }}>
        {/* Service Description */}
        {booking.serviceDescription && (
          <ReadOnlyField label="Service Description" value={booking.serviceDescription} multiline />
        )}

        {/* Row 1: Delivery Address, Special Requirements */}
        <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: "20px" }}>
          <ReadOnlyField label="Delivery Address" value={booking.deliveryAddress} multiline />
          <ReadOnlyField label="Special Requirements" value={booking.specialRequirements} multiline />
        </div>

        {/* Row 2: Requested Date, Completion Date */}
        <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: "20px" }}>
          <ReadOnlyField 
            label="Requested Date" 
            value={booking.requestedDate ? new Date(booking.requestedDate).toLocaleDateString() : "—"} 
          />
          <ReadOnlyField 
            label="Completion Date" 
            value={booking.completionDate ? new Date(booking.completionDate).toLocaleDateString() : "—"} 
          />
        </div>
      </div>
    </div>
  );
}